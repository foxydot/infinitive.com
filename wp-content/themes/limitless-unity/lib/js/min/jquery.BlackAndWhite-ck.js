!function($){$.fn.extend({BlackAndWhite:function(e){"use strict";var t=this,n=$.extend({hoverEffect:!0,webworkerPath:!1,invertHoverEffect:!1,speed:500,onImageReady:null,intensity:1},e),a=n.hoverEffect,i=n.webworkerPath,o=n.invertHoverEffect,r="number"==typeof n.intensity&&n.intensity<1&&n.intensity>0?n.intensity:1,d=$.isPlainObject(n.speed)?n.speed.fadeIn:n.speed,c=$.isPlainObject(n.speed)?n.speed.fadeOut:n.speed,s=$(window),u=".BlackAndWhite",f=document.all&&!window.opera&&window.XMLHttpRequest?!0:!1,l=" -webkit- -moz- -o- -ms- ".split(" "),m={},g=function(e){if(m[e]||""===m[e])return m[e]+e;var t=document.createElement("div"),n=["","Moz","Webkit","O","ms","Khtml"];for(var a in n)if("undefined"!=typeof t.style[n[a]+e])return m[e]=n[a],n[a]+e;return e.toLowerCase()},h=function(){var e=document.createElement("div");return e.style.cssText=l.join("filter:blur(2px); "),!!e.style.length&&(void 0===document.documentMode||document.documentMode>9)}(),p=!!document.createElement("canvas").getContext,v=function(){return"undefined"!=typeof Worker?!0:!1}(),y=g("Filter"),w=[],b=v&&i?new Worker(i+"BnWWorker.js"):!1,W=function(e){$(e.currentTarget).find(".BWfade").stop(!0,!0).animate({opacity:o?0:1},c)},k=function(e){$(e.currentTarget).find(".BWfade").stop(!0,!0).animate({opacity:o?1:0},d)},I=function(e){"function"==typeof n.onImageReady&&n.onImageReady(e)},B=function(e){b&&p&&!h&&!e&&x()},x=function(){return w.length?(b.postMessage({imgData:w[0].imageData,intensity:r}),void(b.onmessage=function(e){w[0].ctx.putImageData(e.data,0,0),I(w[0].img),w.splice(0,1),x()})):(b.terminate&&b.terminate(),void(b.close&&b.close()))},D=function(e){return e.complete||"undefined"!=typeof e.naturalWidth&&e.naturalWidth},E=function(e,t,n,a){var i=t.getContext("2d"),o=e,d=0,c;i.drawImage(e,0,0,n,a);var s=i.getImageData(0,0,n,a),u=s.data,f=u.length;if(b)w.push({imageData:s,ctx:i,img:e});else{for(;f>d;d+=4){var l=.3*u[d]+.59*u[d+1]+.11*u[d+2];u[d]=~~(l*r+u[d]*(1-r)),u[d+1]=~~(l*r+u[d+1]*(1-r)),u[d+2]=~~(l*r+u[d+2]*(1-r))}i.putImageData(s,0,0),I(e)}},_=function(e,t){var n=e[0],a=n.src,i=e.position(),d={top:0,left:i.left,position:"absolute","-webkit-transform":"translate3d(0,0,0)",opacity:o?0:1},c;n.crossOrigin="anonymous",p&&!h?(c=$('<canvas width="'+n.naturalWidth+'" height="'+n.naturalHeight+'" class="BWfade"></canvas>'),d.width=e.width(),d.height=e.height(),E(n,c.get(0),n.naturalWidth,n.naturalHeight)):(p?d[y]="grayscale("+100*r+"%)":d.filter="progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)",c=e.clone().addClass("BWFilter BWfade"),I(n)),c.css(d).prependTo(t),!$.support.opacity&&o&&c.animate({opacity:0},0)},M=function(){t.each(function(e,t){var n=$(t).find("img"),a=$(n).width(),i=$(n).height();$(this).find("canvas").css({width:a,height:i})})},T=function(){var e=t.find("img").filter(function(){return!$(this).data("_b&w")}).length;t.each(function(t,n){var a=$(n),i=a.find("img");i.data("_b&w")||(D(i[0])?(e--,_(i,a)):i.on("load",function(){return i.data("_b&w_loaded")||!i[0].complete?void setTimeout(function(){i.load()},20):(_(i,a),i.data("_b&w_loaded",!0),e--,void B(e))}).load(),i.data("_b&w",!0))}),B(e),a&&t.unbind(u).on("mouseleave"+u,W).on("mouseenter"+u,k),p&&!h&&s.unbind(u).on("resize"+u+" orientationchange"+u,M)},j=function(){t.off(u),s.off(u)};return T(),{destroy:j}}})}(jQuery);